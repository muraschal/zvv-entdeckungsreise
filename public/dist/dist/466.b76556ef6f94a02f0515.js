"use strict";(this.webpackChunkZVVEntdeckungsreiseWidget=this.webpackChunkZVVEntdeckungsreiseWidget||[]).push([[466],{466:(e,a,t)=>{t.r(a),t.d(a,{ZVVEntdeckungsreiseForm:()=>n});var l=t(156);const c={},r=async(e,a,t=3e5)=>{const l=`${e}-${JSON.stringify(a)}`,r=Date.now();if(c[l]&&r-c[l].timestamp<t)return c[l].data;try{const t=await fetch(e,a),n=await t.json();return c[l]={data:n,timestamp:r},n}catch(e){throw console.error("Fehler beim Abrufen der Daten:",e),e}};function n({apiBaseUrl:e="",environment:a="PRD",cacheTimeout:t=3e5}){const[c,n]=(0,l.useState)({code:"",school:"",studentCount:"",travelDate:"",additionalNotes:"",email:"",className:"",contactPerson:"",phoneNumber:"",accompanistCount:"",arrivalTime:""}),[s,m]=(0,l.useState)(!1),[o,i]=(0,l.useState)(""),[d,v]=(0,l.useState)(!1),[u,_]=(0,l.useState)(!1);(0,l.useState)((()=>{console.log(`ZVVEntdeckungsreiseForm Komponente initialisiert - Umgebung: ${a}`),console.log(`Render-Zeitstempel: ${(new Date).toISOString()}`)}));const p=e=>{const{name:a,value:t}=e.target;n((e=>({...e,[a]:t})))};return d?React.createElement("div",{className:"max-w-md mx-auto p-4 bg-white rounded-lg shadow-md"},React.createElement("h1",{className:"text-2xl font-bold text-green-600 mb-4"},"Danke für Ihre Ticketbestellung."),React.createElement("p",{className:"mb-4"},"Die Tickets werden in den nächsten 7 Arbeitstagen an die angegebene Schulhaus-Adresse verschickt. Wir wünschen Ihrer Klasse schon jetzt viel Spass auf der ZVV-Entdeckungsreise."),React.createElement("button",{onClick:()=>v(!1),className:"cmp-button"},React.createElement("span",{className:"cmp-button__text"},"Zurück zum Formular"))):React.createElement("div",{className:"zvv-form max-w-md mx-auto p-4 bg-white rounded-lg shadow-md"},o&&React.createElement("div",{className:"zvv-form__error mb-4 p-3 bg-red-100 text-red-700 rounded"},o),React.createElement("form",{onSubmit:async l=>{if(l.preventDefault(),m(!0),i(""),c.travelDate&&!(e=>{const a=new Date(e),t=new Date;return t.setHours(0,0,0,0),a>=t})(c.travelDate))return i("Das Reisedatum muss in der Zukunft liegen."),void m(!1);try{let l;try{l=await r(`${e}/api/validate`,{method:"POST",headers:{"Content-Type":"application/json","X-Environment":a},body:JSON.stringify({code:c.code})},t)}catch(t){const r=await fetch(`${e}/api/validate`,{method:"POST",headers:{"Content-Type":"application/json","X-Environment":a},body:JSON.stringify({code:c.code})});l=await r.json()}if(!l.valid)return i(l.message||"Ungültiger Code"),void m(!1);const n=await fetch(`${e}/api/redeem`,{method:"POST",headers:{"Content-Type":"application/json","X-Environment":a},body:JSON.stringify({code:c.code,school:c.school,studentCount:parseInt(c.studentCount),travelDate:c.travelDate,additionalNotes:c.additionalNotes,email:c.email,className:c.className,contactPerson:c.contactPerson,phoneNumber:c.phoneNumber,accompanistCount:parseInt(c.accompanistCount||"0"),arrivalTime:c.arrivalTime})}),s=await n.json();n.ok?v(!0):i(s.message||"Ein Fehler ist aufgetreten")}catch(e){i("Ein Fehler ist aufgetreten. Bitte versuche es später erneut."),console.error(e)}finally{m(!1)}},className:"zvv-form__container"},React.createElement("div",{className:"zvv-form__row"},React.createElement("div",{className:"zvv-form__label-col"},React.createElement("label",{htmlFor:"code",className:"zvv-form__label"},"Ticketcode")),React.createElement("div",{className:"zvv-form__input-col"},React.createElement("div",{className:"zvv-form__input-wrapper"},React.createElement("input",{id:"code",className:"zvv-form__input",style:{width:"100%"},placeholder:"Ticketcode eingeben",name:"code",value:c.code,onChange:p,required:!0,"aria-describedby":"code-desc"})))),React.createElement("div",{className:"zvv-form__row"},React.createElement("div",{className:"zvv-form__label-col"},React.createElement("label",{htmlFor:"school",className:"zvv-form__label"},"Schule")),React.createElement("div",{className:"zvv-form__input-col"},React.createElement("div",{className:"zvv-form__input-wrapper"},React.createElement("input",{id:"school",className:"zvv-form__input",style:{width:"100%"},placeholder:"Name der Schule",name:"school",value:c.school,onChange:p,required:!0,"aria-describedby":"school-desc"})))),React.createElement("div",{className:"zvv-form__row"},React.createElement("div",{className:"zvv-form__label-col"},React.createElement("label",{htmlFor:"contactPerson",className:"zvv-form__label"},"Kontaktperson")),React.createElement("div",{className:"zvv-form__input-col"},React.createElement("div",{className:"zvv-form__input-wrapper"},React.createElement("input",{id:"contactPerson",className:"zvv-form__input",style:{width:"100%"},placeholder:"Name der Kontaktperson",name:"contactPerson",value:c.contactPerson,onChange:p,required:!0,"aria-describedby":"contactPerson-desc"})))),React.createElement("div",{className:"zvv-form__row"},React.createElement("div",{className:"zvv-form__label-col"},React.createElement("label",{htmlFor:"email",className:"zvv-form__label"},"E-Mail")),React.createElement("div",{className:"zvv-form__input-col"},React.createElement("div",{className:"zvv-form__input-wrapper"},React.createElement("input",{id:"email",className:"zvv-form__input",style:{width:"100%"},placeholder:"E-Mail-Adresse",name:"email",type:"email",value:c.email,onChange:p,required:!0,"aria-describedby":"email-desc"})))),React.createElement("div",{className:"zvv-form__row"},React.createElement("div",{className:"zvv-form__label-col"},React.createElement("label",{htmlFor:"phoneNumber",className:"zvv-form__label"},"Telefon")),React.createElement("div",{className:"zvv-form__input-col"},React.createElement("div",{className:"zvv-form__input-wrapper"},React.createElement("input",{id:"phoneNumber",className:"zvv-form__input",style:{width:"100%"},placeholder:"Telefonnummer",name:"phoneNumber",type:"tel",value:c.phoneNumber,onChange:p,required:!0,"aria-describedby":"phoneNumber-desc"})))),React.createElement("div",{className:"zvv-form__row"},React.createElement("div",{className:"zvv-form__label-col"},React.createElement("label",{htmlFor:"className",className:"zvv-form__label"},"Klasse")),React.createElement("div",{className:"zvv-form__input-col"},React.createElement("div",{className:"zvv-form__input-wrapper"},React.createElement("div",{className:"zvv-form__dropdown "+(u?"visible":"")},React.createElement("div",{tabIndex:0,className:"zvv-form__dropdown-label",onClick:()=>_(!u)},c.className||"Bitte wählen"),React.createElement("div",{className:"zvv-form__dropdown-options"},React.createElement("div",{className:"zvv-form__dropdown-option "+(c.className?"":"zvv-form__dropdown-option--selected"),"data-value":"",onClick:()=>{n((e=>({...e,className:""}))),_(!1)}},"Bitte wählen"),React.createElement("div",{className:"zvv-form__dropdown-option "+("4. Klasse"===c.className?"zvv-form__dropdown-option--selected":""),"data-value":"klasse-4",onClick:()=>{n((e=>({...e,className:"4. Klasse"}))),_(!1)}},"4."),React.createElement("div",{className:"zvv-form__dropdown-option "+("5. Klasse"===c.className?"zvv-form__dropdown-option--selected":""),"data-value":"klasse-5",onClick:()=>{n((e=>({...e,className:"5. Klasse"}))),_(!1)}},"5."),React.createElement("div",{className:"zvv-form__dropdown-option "+("6. Klasse"===c.className?"zvv-form__dropdown-option--selected":""),"data-value":"klasse-6",onClick:()=>{n((e=>({...e,className:"6. Klasse"}))),_(!1)}},"6."))),React.createElement("div",{className:"zvv-form__dropdown-spacer"}),React.createElement("input",{type:"hidden",id:"className",name:"className",value:c.className,required:!0,"aria-describedby":"className-desc"})))),React.createElement("div",{className:"zvv-form__row"},React.createElement("div",{className:"zvv-form__label-col"},React.createElement("label",{htmlFor:"studentCount",className:"zvv-form__label"},"Anzahl Schüler")),React.createElement("div",{className:"zvv-form__input-col"},React.createElement("div",{className:"zvv-form__input-wrapper"},React.createElement("input",{id:"studentCount",className:"zvv-form__input",style:{width:"100%"},placeholder:"Anzahl der Schüler",name:"studentCount",type:"number",min:"1",value:c.studentCount,onChange:p,required:!0,"aria-describedby":"studentCount-desc"})))),React.createElement("div",{className:"zvv-form__row"},React.createElement("div",{className:"zvv-form__label-col"},React.createElement("label",{htmlFor:"accompanistCount",className:"zvv-form__label"},"Begleitpersonen")),React.createElement("div",{className:"zvv-form__input-col"},React.createElement("div",{className:"zvv-form__input-wrapper"},React.createElement("input",{id:"accompanistCount",className:"zvv-form__input",style:{width:"100%"},placeholder:"Anzahl der Begleitpersonen",name:"accompanistCount",type:"number",min:"1",value:c.accompanistCount,onChange:p,required:!0,"aria-describedby":"accompanistCount-desc"})))),React.createElement("div",{className:"zvv-form__row"},React.createElement("div",{className:"zvv-form__label-col"},React.createElement("label",{htmlFor:"travelDate",className:"zvv-form__label"},"Reisedatum")),React.createElement("div",{className:"zvv-form__input-col"},React.createElement("div",{className:"zvv-form__input-wrapper"},React.createElement("input",{id:"travelDate",className:"zvv-form__input",style:{width:"100%"},placeholder:"Reisedatum auswählen",name:"travelDate",type:"date",min:(new Date).toISOString().split("T")[0],value:c.travelDate,onChange:p,required:!0,"aria-describedby":"travelDate-desc"})))),React.createElement("div",{className:"zvv-form__row"},React.createElement("div",{className:"zvv-form__label-col"},React.createElement("label",{htmlFor:"arrivalTime",className:"zvv-form__label"},"Ankunftszeit")),React.createElement("div",{className:"zvv-form__input-col"},React.createElement("div",{className:"zvv-form__input-wrapper"},React.createElement("input",{id:"arrivalTime",className:"zvv-form__input",style:{width:"100%"},placeholder:"Ankunftszeit auswählen",name:"arrivalTime",type:"time",value:c.arrivalTime,onChange:p,required:!0,"aria-describedby":"arrivalTime-desc"})))),React.createElement("div",{className:"zvv-form__row"},React.createElement("div",{className:"zvv-form__label-col"},React.createElement("label",{htmlFor:"additionalNotes",className:"zvv-form__label"},"Anmerkungen")),React.createElement("div",{className:"zvv-form__input-col"},React.createElement("div",{className:"zvv-form__input-wrapper"},React.createElement("textarea",{id:"additionalNotes",className:"zvv-form__textarea",placeholder:"Zusätzliche Anmerkungen",name:"additionalNotes",rows:2,value:c.additionalNotes,onChange:p,"aria-describedby":"additionalNotes-desc"})))),React.createElement("div",{className:"text-sm text-grey mb-4"},"* Alle Felder sind Pflichtfelder, ausser Anmerkungen"),React.createElement("button",{className:"cmp-button",type:"submit",disabled:s},React.createElement("span",{className:"cmp-button__text"},s?"Wird verarbeitet...":"Anmeldung absenden"))))}}}]);